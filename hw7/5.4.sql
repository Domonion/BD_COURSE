create view StudentDebts as select Students.StudentId, case when StudentsWithDebts.Debts is null then 0 else StudentsWithDebts.Debts end as Debts from (Students left join (select InnerTable.StudentId as StudentId, count(distinct InnerTable.CourseId) as Debts from (select StudentsWithCourses.StudentId as StudentId, StudentsWithCourses.CourseId as CourseId, StudentsWithMarks.Mark as Mark from ((select StudentId, CourseId from Students natural join Plan) as StudentsWithCourses left join (select StudentId, CourseId, Mark from Students natural join Marks) as StudentsWithMarks on StudentsWithCourses.StudentId = StudentsWithMarks.StudentId and StudentsWithCourses.CourseId = StudentsWithMarks.CourseId) where Mark is null) as InnerTable group by InnerTable.StudentId) as StudentsWithDebts on Students.StudentId = StudentsWithDebts.StudentId)